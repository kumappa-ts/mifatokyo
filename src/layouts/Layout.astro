---
import { siteConfig } from "../config/site";
import { Image } from "astro:assets";

// import "modern-normalize";
import "../styles/global.scss";
import logo from "../../public/mifa.svg";
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";
import WebVitals from "../components/WebVitals.astro";
import { ClientRouter, fade, slide } from "astro:transitions";
interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;

const ga4TrackingCode = `
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VSZJNY04HM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VSZJNY04HM');
</script>
`;
---

<html lang="ja">
  <head>
    <Fragment set:html={ga4TrackingCode} />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- サイト情報 -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta
      property="og:image"
      content={siteConfig.siteDomain + siteConfig.ogImage}
    />
    <meta property="og:site_name" content={siteConfig.name} />
    <meta property="twitter:card" content="summary_large_image" />
    <!-- テーマカラー -->
    <meta name="theme-color" content="#030014" />
    <!-- フォント読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=M+PLUS+Rounded+1c:wght@400;500;700;800;900&display=swap"
      rel="stylesheet"
      rel="preload"
      as="style"
      fetchpriority="high"
    />
    <!-- ファビコン -->
    <link rel="icon" href={siteConfig.fcImage} />
    <!-- <ViewTransitions /> -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-PK2MVWB"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->
    <div class="container-bg"></div>
    <main>
      <div class="main-container">
        <header class="main-container__header">
          <a class="container-logo" href="/">
            <Image src={logo} alt="mifa" class="site-logo" />
          </a>
          <div class="container-header">
            <Navigation />
          </div>
        </header>
        <div class="main-container__body">
          <slot />
          <Footer />
          <WebVitals />
        </div>
        <footer class="main-container__foot">
          <div class="container-footer">
            <p>{siteConfig.siteCopy}</p>
          </div>
        </footer>
      </div>
    </main>
  </body><style lang="scss">
    .container-bg {
      position: fixed;
      inset: 0;
      margin: auto;
      width: 100%;
      height: 100%;
      background: #111;
    }
    .main-container {
      background: $black;
      @include mq {
        background: $white;
        display: grid;
        grid-template-columns: 2fr 5fr auto;
        align-items: center;
        // padding: 2rem 0;
        max-height: 100vh;
        // grid-template-columns: auto auto 1fr;
      }
    }
    .main-container__header {
      display: block;
      padding: $size-md16;
      @include mq {
        display: grid;
        height: 100%;
        position: relative;
      }
    }
    .container-logo {
      display: grid;
      position: relative;
      width: 128px;
      @include mq {
        position: fixed;
        z-index: 10;
        left: 2rem;
        top: 2rem;
      }
    }
    .site-logo {
      filter: invert(1);
      aspect-ratio: 128/51;
    }
    .container-header {
      position: fixed;
      width: 92%;
      left: 50%;
      translate: -50% 0;
      bottom: 3cqi;
      z-index: 9999;
      padding: 1rem;
      backdrop-filter: blur(10px);
      background: rgba($white, 0.5);
      border-radius: 0.4rem;
      overflow: hidden;
      box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.2);
      @include mq {
        box-shadow: none;
        padding: 0;
        border-radius: none;
        backdrop-filter: none;
        background: transparent;
        left: auto;
        translate: unset;
        width: 100%;
        height: calc(100vh - 5.2rem);
        position: sticky;
        top: 2.6rem;
      }
    }
    .main-container__body {
      overflow: hidden;
      position: relative;
      container-type: inline-size;
      border-radius: 1.2rem;
      border: 6px solid #000;
      background: $white;
      @include mq {
        margin: 2rem 0;
        min-height: calc(100vh - 4rem);
        max-width: 800px;
        display: flex;
        flex-direction: column;
      }
    }
    .main-container__foot {
      position: relative;
      padding: $size-smp12 $size-smp12 $size-smp88;
      height: 100%;
      @include mq {
        padding: 0 4rem;
      }
    }
    .container-footer {
      text-align: center;
      display: grid;
      justify-content: center;
      align-content: center;
      @include mq {
        left: auto;
        translate: unset;
        height: calc(100vh - 4rem);
        width: 100%;
        position: sticky;
        top: 2rem;
        p {
          writing-mode: vertical-rl;
          text-orientation: mixed;
          rotate: 180deg;
        }
      }
      p {
        color: #fff;
      }
    }
  </style>
  <script>
    const splitType = document.querySelectorAll(
      ".split-type",
    ) as NodeListOf<HTMLElement>;
    const initializeSpanWrap = () => {
      splitType.forEach((type) => {
        new SplitType(type);
      });
      document.addEventListener("DOMContentLoaded", () => {
        initializeSpanWrap();
      });
    };
  </script>
  <script>
    import Lenis from "lenis";
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import SplitType from "split-type";

    // プラグインを登録
    gsap.registerPlugin(ScrollTrigger);

    // Lenis初期化
    const lenis = new Lenis({
      duration: 1.2,
      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
      // smooth: true,  // デフォルトでtrue
      // smoothTouch: false,  // スマホでの挙動
    });

    // LenisとScrollTriggerを連携
    lenis.on("scroll", ScrollTrigger.update);

    gsap.ticker.add((time) => {
      lenis.raf(time * 1000); // GSAPのtickerを使う方が効率的
    });

    gsap.ticker.lagSmoothing(0);

    // SplitType初期化
    const initializeSpanWrap = () => {
      const splitElements = document.querySelectorAll(
        ".split-type",
      ) as NodeListOf<HTMLElement>;

      splitElements.forEach((element) => {
        new SplitType(element, {
          types: "chars, words, lines", // 必要なものだけ
        });
      });
    };

    // DOMContentLoaded
    document.addEventListener("DOMContentLoaded", () => {
      initializeSpanWrap();
      // console.log('Lenis & SplitType initialized');
    });
  </script>
</html>
