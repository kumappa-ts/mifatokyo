---
import { siteConfig } from "../config/site";
import { Image } from "astro:assets";

// import "modern-normalize";
import "../styles/global.scss";
import logo from "../../public/mifa.svg";
import WebVitals from "../components/WebVitals.astro";
interface Props {
  title: string;
  description: string;
}

const { title, description } = Astro.props;

const ga4TrackingCode = `
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VSZJNY04HM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VSZJNY04HM');
</script>
`;
---

<html lang="ja">
  <head>
    <Fragment set:html={ga4TrackingCode} />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- サイト情報 -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <meta property="og:title" content={title} />
    <meta
      property="og:description"
      content={"mifa.tokyoでの活動の中で、『こんなのがあったらいいな』と思った便利道具を作りました。今回は、" +
        description}
    />
    <meta
      property="og:image"
      content={siteConfig.siteDomain + siteConfig.ogImage}
    />
    <meta property="og:site_name" content={siteConfig.name} />
    <meta property="og:url" content={siteConfig.siteDomain} />
    <meta property="twitter:card" content="summary_large_image" />
    <meta
      name="canonical"
      content={siteConfig.siteDomain + Astro.url.pathname + "/"}
    />
    <!-- テーマカラー -->
    <meta name="theme-color" content="#030014" />
    <!-- フォント読み込み -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=M+PLUS+Rounded+1c:wght@400;500;700;800;900&display=swap"
      rel="stylesheet"
      rel="preload"
      as="style"
      fetchpriority="high"
    />
    <!-- ファビコン -->
    <link rel="icon" href={siteConfig.fcImage} />
    <!-- <ViewTransitions /> -->
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-PK2MVWB"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->
    <div class="container-bg"></div>
    <main class="tools-main">
      <header class="tools-header">
        <a class="tools-header-logo" href="/">
          <Image src={logo} alt="mifa" class="site-logo" />
        </a>
        <nav class="tools-header-nav">
          <a class="tools-header-nav-item" href="/">
            <p class="tools-header-nav-item__text">mifa.tokyo Home</p>
          </a>
          <a class="tools-header-nav-item" href="/tools/device-info">
            <p class="tools-header-nav-item__text">デバイス情報取得</p>
          </a>
          <a class="tools-header-nav-item" href="/tools/image-converter">
            <p class="tools-header-nav-item__text">画像変換・編集</p>
          </a>
          <a class="tools-header-nav-item" href="/tools/code-formatter">
            <p class="tools-header-nav-item__text">コード整形</p>
          </a>
        </nav>
      </header>
      <div class="tools-container">
        <slot />
        <WebVitals />
        <footer class="tools-footer">
          <div class="tools-footer__copy">
            <p>{siteConfig.siteCopy}</p>
          </div>
        </footer>
      </div>
    </main>
    <style lang="scss">
      .container-bg {
        position: fixed;
        inset: 0;
        margin: auto;
        width: 100%;
        height: 100%;
        background: #111;
      }
      .tools-main {
        display: grid;
        margin: auto;
        padding: 0;
        grid-template-columns: 1fr;
        gap: 2rem;
        @include mq {
          padding: 2rem;
          max-width: 1280px;
          grid-template-columns: auto 1fr;
          gap: 3.2rem;
        }
      }
      .tools-header {
        z-index: 10;
        width: fit-content;
        border-radius: 0 0 0.8rem 0;
        background-color: $white;
        padding: 2rem;
        margin: 0;
        grid-template-columns: auto 1fr;
        align-items: center;
        display: grid;
        gap: 2rem;
        position: sticky;
        height: fit-content;
        top: 0;
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        @include mq {
          filter: none;
          grid-template-columns: 1fr;
          padding: 2rem 3.2rem;
          border-radius: 0.8rem;
          top: 2rem;
        }
      }
      .tools-header-logo {
        display: grid;
        width: 8rem;
      }
      .tools-header-nav {
        display: grid;
        gap: 1rem;
      }
      .tools-header-nav-item {
      }
      .tools-header-nav-item__text {
        font-size: 1.4rem;
        font-weight: 500;
      }
      .tools-container {
        min-inline-size: 0;
        padding: 0 2rem;
        @include mq {
          padding: 0;
        }
      }
      .tools-footer {
        position: relative;

        padding: 2rem;
        text-align: center;
      }
      .tools-footer__copy {
        p {
          font-size: 1rem;
          letter-spacing: 0.1em;
          font-weight: 500;
          color: $white;
        }
      }
    </style>
    <script>
      const splitType = document.querySelectorAll(
        ".split-type",
      ) as NodeListOf<HTMLElement>;
      const initializeSpanWrap = () => {
        splitType.forEach((type) => {
          new SplitType(type);
        });
        document.addEventListener("DOMContentLoaded", () => {
          initializeSpanWrap();
        });
      };
    </script>
    <script>
      import Lenis from "lenis";
      import { gsap } from "gsap";
      import { ScrollTrigger } from "gsap/ScrollTrigger";
      import SplitType from "split-type";

      // プラグインを登録
      gsap.registerPlugin(ScrollTrigger);

      // Lenis初期化
      const lenis = new Lenis({
        duration: 1.2,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        // smooth: true,  // デフォルトでtrue
        // smoothTouch: false,  // スマホでの挙動
      });

      // LenisとScrollTriggerを連携
      lenis.on("scroll", ScrollTrigger.update);

      gsap.ticker.add((time) => {
        lenis.raf(time * 1000); // GSAPのtickerを使う方が効率的
      });

      gsap.ticker.lagSmoothing(0);

      // SplitType初期化
      const initializeSpanWrap = () => {
        const splitElements = document.querySelectorAll(
          ".split-type",
        ) as NodeListOf<HTMLElement>;

        splitElements.forEach((element) => {
          new SplitType(element, {
            types: "chars, words, lines", // 必要なものだけ
          });
        });
      };

      // DOMContentLoaded
      document.addEventListener("DOMContentLoaded", () => {
        initializeSpanWrap();
        // console.log('Lenis & SplitType initialized');
      });
    </script>
  </body>
</html>
